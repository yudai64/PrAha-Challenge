# 課題1
- 「mailAddress」カラムには、特定のドメインを持ったメールアドレスしか登録できない（a@example.com, b@example.comなど）。Checkを使うべきでしょうか？
  - 整合性を担保したいなら使ってもいい

- ユーザーが退会した時、当該ユーザーのレコードを「User」テーブルから削除し、同じ情報を「WithdrawnUser」テーブルに挿入しなければいけない。Triggerを使うべきでしょうか？
  - 基本的には使わなくてもいい
    - 保守性など考慮するとアプリケーションで実装した方がよさそう
      - コードで書かれてた方が見やすいし、改修もしやすい

- 「gender」カラムには「male」「female」「no response」いずれかの値しか入れてはいけない。Enumを使うべきでしょうか？
  - 基本的には使わなくてもいい
    - アプリケーションでこれらの値を使用したいケースがおそらくあるため
    - Enumの定義が変わる可能性もある
    - 性別テーブルのようなものを作成した方がよさそう

- 「postCode」カラムには特定形式の文字列しか入れてはいけない。Domainを使うべきでしょうか？
  - 整合性を担保したいなら使ってもいい

<br>

- ***Check***
  - 使ってもいい
    - 絶対に整合性を担保したい場合
  - 使わないべき
    - 複雑なロジックを持つ場合
    - 使わないべきとまでは行かないがアプリケーションでも制御してるはずなので、そこまで使うメリットがわからず。。
      - ロジックの変更時に修正箇所が増える

- ***Trigger***
  - 使ってもいい
    - ログを残す場合
    - データ移行 (例題のようなイメージ)
    - 集計用のデータを保持しておきたい場合
  - 使わないべき
    - 複雑なロジックが必要な場合
      - 改修コストが高い
        - デバッグしづらい
        - ロジックが分離しているので影響範囲の特定が時間かかる

- ***Enum***
  - 使ってもいい
    - あまりない。。？
  - 使わないべき
    - 設定する値が変更される可能性がある場合
      - Enumの値を変更、削除したいとすると
      - 変更される値を持つレコードをUPDATEした後、テーブル定義を変更する必要がある
    - 設定する値のリストをアプリケーションで使用したい場合
      - DBから単にSELECTするだけでは使用できない(ダブルクォートなど取り除く処理が必要)
      - アプリケーションで別に定義する場合は、二重管理になるのでメンテナンスに気をつける必要がある
    - 数値を設定したい場合
      - 引用符の有無によって動作が変わるので混乱しやすい
      - https://dev.mysql.com/doc/refman/5.6/ja/enum.html#enum-literals

- ***Domain***
  - 使うべき
    - 絶対に整合性を担保したい場合
      - また、同じ定義を使いまわしたい場合
  - 使わないべき
    - 設定する値が変更される可能性がある場合

<br>

# 課題2
- トリガーでロジックを実装しているサービス
  - トリガーを実装した本人が既にいなかったり、ドキュメントが残っていない場合
    - コードを読んでいるだけでは理解できない動作があり、改修に時間がかかる

---
### 参考
- [MySQL Triggerのデメリットが大きいので使わないで欲しい](https://www.banana-juice.com/tech/articles/mysql/trigger-demerit)
  - 使い道
    - ログ
    - アプリケーションロジック
    - データ移行
    - 集計
  - アプリケーションロジックをトリガーで書いてあるシステムは苦労する
    - 複雑な仕様に耐えられない
      - 複雑な業務情報を叶えるにはSQLでは不十分
      - 容易に変更できない
    - 拡張性に乏しい
      - 改修しようと思った場合に、DB以外の技術のアプローチが取りづらくなる
        - アプリケーションで対応可能なキャッシュや並行処理ができない
    - ブラックボックス
      - どこで何を処理しているかわからなくなってしまう
      - データとアプリケーションが密結合してしまっている
    - データ移行がしづらい
      - データ移行をしたいだけでも、トリガー(=ロジック)を移行する必要があり、システム移行になってしまう
    - デバッグがしづらい
      - ステップ実行ができない
  - トリガーだけで完結できるものを目指して欲しい
  - データ移行やレプリケーション機能でメリットを発揮して欲しい
  - トリガーのデメリットは開発時ではなく、運用時に起こる
- [3分でわかるトリガー -使い所と問題点を考える](https://qiita.com/wanko5296/items/fa3620c48196acbd3ab6)
  - 使い所
    - イベントロギング
    - 導入項目・集計値の自動生成
    - ビジネスルールの実現
  - トリガーの問題点
    - ビジネスロジックの分離による影響範囲の拡大
    - テーブル間の依存性
- [便利なデータベーストリガーを正しく使おう！](https://blog.recruit.co.jp/rmp/server-side/post-17798/)
  - トリガーを使う際に強く意識すべきことは、データベースにビジネスロジックを持たせているという点
  - トリガーは基本的に使用せずビジネスロジックはアプリケーションで実装する
  - ただしリファクタリング時などトリガーの使用期間が決まっており、トリガーによる総工数が下げる場合に下げる場合には導入を検討する